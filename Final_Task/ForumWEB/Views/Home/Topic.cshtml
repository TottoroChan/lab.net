@model  List<MessagesViewModel>
@using ForumWEB.Models

@{
    ViewBag.Title = ViewBag.TopicName;
}

<table>
    <tbody>
        <tr>
            <td width="25%"><font class="text">Автор</font></td>
            <td width="75%"><font class="text">Сообщение</font></td>
        </tr>
        <tr>
            <td class="user">
                <div>
                    <b><font class="text">@ViewBag.AuthorName</font></b><br />
                    <div><img scr="@ViewBag.Avatar" width="120" height="120" /></div><br />
                    <div ><font class="text">@ViewBag.CreateDate</font></div>
                </div>
            </td>
            <td class="message">
                <div ><b><font class="text">@ViewBag.TopicName</font></b></div>
                <hr>
                <div ><font class="text">@ViewBag.TopicText</font></div>
            </td>
        </tr>
        <tr>
            <td colspan="2"></td>
        </tr>
        @if (Model.Count != 0)
        {
            for (int i = 0; i < Model.Count; i++)
            {
                if (User.IsInRole("Administrator") && (@Model[i].StatusID == 0))
                {
                    <tr>
                        <td colspan="2">
                            @Html.ActionLink("Сделать сообщение видимым", "ChangeMessageStatus", "Admin",
                                new { MessageID = Model[i].MessageID, StatusID = 1, TopicID = ViewBag.TopicID }, null)
                        </td>
                    </tr>
                  <tr>
                    <td class="user">
                        <div >
                            <b><font class="text">@Model[i].Name</font></b><br />
                            <div><img scr="@ViewBag.Avatar" width="120" height="120" /></div><br />
                            <div><font class="text">@Model[i].SendDate</font></div>
                        </div>
                    </td>
                    <td class="message">
                        <div class="font1"><font class="text">@Model[i].Text</font></div>
                    </td>
                </tr>}
                if (@Model[i].StatusID == 1)
                {
                    if (User.IsInRole("Administrator"))
                    {
                        <tr>
                            <td colspan="2">
                                @Html.ActionLink("Сделать сообщение невидимым", "ChangeMessageStatus", "Admin",
                                       new { MessageID = Model[i].MessageID, StatusID = 0, TopicID = ViewBag.TopicID }, null)
                            </td>
                        </tr>}
                    <tr>
                        <td class="user">
                            <div >
                                <b><font class="text">@Model[i].Name</font></b><br />
                                <div ><font class="text">@Model[i].SendDate</font></div>
                            </div>
                        </td>
                        <td class="message">
                            <div ><font class="text">@Model[i].Text</font></div>
                        </td>
                    </tr>}
            }
        }
        else
        {
            <tr>
                <td colspan="2"><font class="text">В теме ещё нет сообщений.</font></td>
            </tr>
        }
    </tbody>
</table>

@Html.Action("NewMessage", "Home", new { TopicID = ViewBag.TopicID })